"use strict";$(function(){var t,c=function(t){var a=document.cookie.split("; "),n=!0,i=!1,c=void 0;try{for(var e,r=a[Symbol.iterator]();!(n=(e=r.next()).done);n=!0){var p=e.value.split("=");if(t==p[0])return p[1]}}catch(t){i=!0,c=t}finally{try{!n&&r.return&&r.return()}finally{if(i)throw c}}}("username");function n(t,a,n){$.ajax({type:"post",url:"../api/mycart.php",data:"username="+t+"&type="+a+"&shopid="+n,success:function(t){JSON.parse(t).cart}})}function e(){var t=$("#cartin").find(".ckbtn").size(),a=$("#cartin").find(".ckbtn:checked").size(),n=$("#cartin").find(".ckbtn:checked");0==a?($("#totalprice").html("0"),$("#pp").html("0")):(function(t,a){for(var n=0,i=0;i<a;i++){n+=t.eq(i).parent().parent().find(".numval").val()*t.eq(i).parent().parent().find(".mpri strong").html(),$("#totalprice").html(n),$("#pp").html(n)}}(n,a),a==t?$(".txc input").prop("checked",!0):$(".txc input").prop("checked",!1))}$("#pay").on("click",function(){c?alert("结算部分未完成，该项目终点到此为止"):alert("您还未登录")}),$("#smallpay").on("click",function(){c?alert("结算部分未完成，该项目终点到此为止"):alert("您还未登录")}),c?(t=c,$.ajax({type:"post",url:"../api/mycart.php",data:"username="+t,success:function(t){for(var a=JSON.parse(t).cart,n="",i=0;i<a.length;i++)n+='\n                        <li class="pro clearfix" data-id="'+a[i].shopid+'">\n                        <p class="ck"><input name="ckb" class="ckbtn" type="checkbox" ></p>\n                        <p class="img"><a href="##" target="_blank"><img src=".'+a[i].imgurl+'"></a></p>\n                        <p class="txt"><a href="##" target="_blank">'+a[i].title+'</a></p>\n                        <p class="mpri"><del>'+a[i].hcprice+"</del><strong>"+a[i].price+'</strong></p>\n                        <p class="save">\n                            <strong>'+(a[i].hcprice-a[i].price)+"</strong>\n                            <small>"+Math.floor(a[i].price/a[i].hcprice*100)+'折</small>\n                        </p>\n                        <p class="sunm" data-id="'+a[i].shopid+'">\n                            <input id="" class="numval" style="text-align:center" name="goodsnum" value="'+a[i].num+'" type="text" >\n                            <i class="add">+</i>\n                            <i class="min">-</i>\n                        </p>\n                        <p class="pri">\n                            <strong>'+a[i].price+'</strong>\n                        </p>\n                        <p class="st">\n                            <span class="del" >X</span>\n                        </p>\n                        <div class="clr"></div>\n                        </li>',$("#cartin").html(n)}})):alert("请先登录"),$("#cartin").on("click",".add",function(){var t=$(this).siblings("input"),a=$(this).parent().attr("data-id"),n=t.val();if(t.val()<=30){t.val(1*n+1);var i=t.val();$.ajax({type:"post",url:"../api/mycart.php",data:"shopid="+a+"&type=update&num="+i+"&username="+c,success:function(){}}),e()}}),$("#cartin").on("click",".min",function(){var t=$(this).siblings("input"),a=$(this).parent().attr("data-id"),n=t.val();if(!(t.val()<=1)){t.val(1*n-1);var i=t.val();$.ajax({type:"post",url:"../api/mycart.php",data:"shopid="+a+"&type=update&num="+i+"&username="+c,success:function(){}}),e()}}),$("#cartin").on("input",".sunm input",function(){var t=$(this).parent().attr("data-id"),a="update";if(30<=$(this).val()){$(this).val(30);var n=$(this).val();$.ajax({type:"post",url:"../api/mycart.php",data:"shopid="+t+"&type="+a+"&num="+n+"&username="+c,success:function(){}}),e()}else if($(this).val()<=0){$(this).val(1);n=$(this).val();$.ajax({type:"post",url:"../api/mycart.php",data:"shopid="+t+"&type="+a+"&num="+n+"&username="+c,success:function(){}}),e()}else{n=$(this).val();$.ajax({type:"post",url:"../api/mycart.php",data:"shopid="+t+"&type="+a+"&num="+n+"&username="+c,success:function(){}}),e()}}),$(".txc input").on("click",function(){var t=$(".txc input").prop("checked");$("#cartin").find(".ckbtn").prop("checked",t),e()}),$("#cartin").on("click",".ckbtn",function(){e()}),$(".alldel").on("click",function(){if(c){if(confirm("你真要全部删除吗?")){$("#cartin").remove(),n(c,"alldel",""),e()}}else alert("请您先登录")}),$("#cartin").on("click",".del",function(){var t=$(this).parent().parent(),a=t.attr("data-id");n(c,"del",a),t.remove(),e()})});